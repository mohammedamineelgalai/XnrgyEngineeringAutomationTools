<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns:innovasys xmlns:MSHelp="http://msdn.microsoft.com/mshelp">
<head>
    <!--DXMETADATA start type="MetaCharset" --><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"><!--DXMETADATA end-->
    <meta content="history" name="save" />
    <meta name="GENERATOR" content="Innovasys HelpStudio (http://www.innovasys.com)" />
    <!--DXMETADATA start type="ItemTitle" format="<title>%%ItemTitle%%</title>" --><title>Viewing Thumbnail Properties</title><!--DXMETADATA end-->
    <link rel="stylesheet" type="text/css" href="stylesheets/helpstudio.css" />
    <!--DXMETADATA start type="Literal" condition="communityenabled" value="<link rel=""stylesheet"" type=""text/css"" href=""stylesheets/community.css"">" --><!--DXMETADATA end-->
    <!--DXMETADATA start type="Literal" condition="helpversion:value=2" value="<link rel=""stylesheet"" type=""text/css"" href=""stylesheets/help2.css"">" --><!--DXMETADATA end -->
    <!--DXMETADATA start type="Stylesheets" --><link rel="stylesheet" type="text/css" href="stylesheets/hs-boxes.css"></link>
    <link rel="stylesheet" type="text/css" href="stylesheets/hs-expandcollapse.css"></link>
    <link rel="stylesheet" type="text/css" href="stylesheets/hs-simpletab.css"></link>
    <link rel="stylesheet" type="text/css" href="stylesheets/hs-heading-expandcollapse.css"></link>
    <link rel="stylesheet" type="text/css" href="stylesheets/hs-tabstrip.css"></link><!--DXMETADATA end-->
    <script src="script/helpstudio.js" type="text/javascript"></script>
    <!--DXMETADATA start type="Literal" condition="communityenabled" value="<script src=""script/community.js""></script>" --><!--DXMETADATA end -->
    <!--DXMETADATA start type="Scripts" --><script src="script/hs-expandcollapse.js" type="text/javascript"></script>
    <script src="script/hs-enlargeimage.js" type="text/javascript"></script>
    <script src="script/swfobject.js" type="text/javascript"></script>
    <script src="script/hs-common.js" type="text/javascript"></script>
    <script src="script/hs-heading-expandcollapse.js" type="text/javascript"></script>
    <script src="script/hs-tabstrip.js" type="text/javascript"></script><!--DXMETADATA end-->
    <!--DXMETADATA start type="Variable" name="BannerColor" format="<style type=text/css>div#pagetop, div#pagetop table td, span#projecttitle, span#pagetitle {background-color: %%Variable%%}</style>" blankformat="" --><!--DXMETADATA end -->
    <!--DXMETADATA start type="Variable" name="BannerTextColor" format="<style type=text/css>div#pagetop, div#pagetop table td, span#projecttitle, span#pagetitle {color: %%Variable:Name=BannerTextColor%%}</style>" blankformat="" --><!--DXMETADATA end -->
	<!--DXMETADATA start type="Variable" name="TopicXMLIsland" condition="helpversion:value=2" --><!--DXMETADATA end-->
    <!--DXMETADATA start type="DesignTime" --><!--DXMETADATA end-->
    <!--DXMETADATA start type="CanonicalLink" --><!--DXMETADATA end-->
    <!--DXMETADATA start type="CustomHeadContent" --><!--DXMETADATA end-->
</head>
<body id="hsbody">
	<!--DXMETADATA start type="Scrap" condition="communityenabled" name="_COMMUNITY_PROPERTIES" --><!--DXMETADATA end -->
    <div style="display: none">
        <input type="hidden" id="userDataCache" class="userDataStyle" name="userDataCache" />
        <input type="hidden" id="hiddenScrollOffset" name="hiddenScrollOffset" />
    </div>
    <img id="collapseImage" style="display:none; height:0; width:0;" src="images/collapse.gif">
    <img id="expandImage" style="display:none; height:0; width:0;" src="images/expand.gif"/>
    <img id="copyImage" style="display:none; height:0; width:0;" src="images/copycode.gif"/>
    <img id="copyHoverImage" style="display:none; height:0; width:0;" src="images/copycodeHighlight.gif">
    <img id="dropDownImage" style="display:none; height:0; width:0;" src="images/drpdown.gif"/>
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="images/drpdown_orange.gif"/>
    <div id="pagetop">
        <!--DXMETADATA start type="DesignBanner" --><!--DXMETADATA end -->
        <table width="100%" id="pagetoptable2" cellspacing="0" cellpadding="0">
        	<tr>
        		<td><!--DXMETADATA start type="Literal" condition="communityenabled" value="%%scrap:name=_COMMUNITY_RATING%%%%scrap:name=_COMMUNITY_DROPDOWN%%" --><!--DXMETADATA end --></td>
        	</tr>
        </table>
        <table width="100%" id="pagetoptable1">
            <tr id="pagetoptable1row1">
                <td align="left">
                    <span id="projecttitle">
                        <!--DXMETADATA start type="ProjectTitle" -->Vault SDK<!--DXMETADATA end-->
                    </span>
                </td>
                <td align="right" rowspan="2">
                    <!--DXMETADATA start type="LogoImage" --><!--DXMETADATA end-->
                </td>
            </tr>
            <tr id="pagetoptable1row2">
                <td align="left">
                    <span id="pagetitle">
                        <!--DXMETADATA start type="ItemTitle" -->Viewing Thumbnail Properties<!--DXMETADATA end-->
                    </span>
                </td>
            </tr>
            <tr id="pagetoptable1row3">
            	<td colspan="2">
            		<!--DXMETADATA start type="Literal" condition="childitems:itemtype=linkcategory" value="<a href=""#seealsobookmark"">%%Phrase:Name=SeeAlso,BlankFormat=See Also%%</a>" --><!--DXMETADATA end -->
            		<span id="feedbacklink"><!--DXMETADATA start type="Variable" name="FeedbackLink" format="" --><a href="http://forums.autodesk.com/t5/vault-customization/bd-p/301 " rel="noopener noreferrer" target="_blank">Send Feedback</a><!--DXMETADATA end --></span>
            	</td>
            </tr>
        </table>
        <!--DXMETADATA start type="Breadcrumbs" scrap="_BREADCRUMBS" --><table width="100%" id="pagetopbreadcrumbs" cellspacing="0" cellpadding="0"><tr><td>
<a href="topic46.html">Knowledge Base</a>
 > Viewing Thumbnail Properties</td></tr></table><!--DXMETADATA end -->
        <!--DXMETADATA start type="Scrap" condition="communityenabled" name="_COMMUNITY_MENU" --><!--DXMETADATA end -->
    </div>
    <div class="hspopupbubble" id="hsglossaryitembox">
        <p>Glossary Item Box</p>
    </div>
    <div id="pagebody">
        <div id="mainbody">
<!--DXMETADATA start type="TopicSection" name="BodyText"--><div class="mainpage">
    Here is how you view thumbnail property data from Vault.<br />
    <br />
    <b>Background:</b><br />
    There are two types of thumnails that may be returned.&nbsp; Thumbnails created in&nbsp;older Vaults will be in the Metafile format.&nbsp; Newer Vaults will return JPEG thumbnails.
</div>

<div class="mainpage">
    <br />
    <b>Sample Code:</b><br />
    Once you have found the PropInst object with the thumbnail value, here is how you can render it to a System.Drawing.Image object.<br />
    <br />
    C#:
</div>

<div class="mainpage">
    <table cellspacing="2" cellpadding="2" width="100%" border="1">
        <tbody>
            <tr>
                <td valign="top">
                    <pre>
public static Image RenderThumbnailToImage(PropInst propInst, int width, int height)
{
    // convert the property value to a byte array
    byte[] thumbnailRaw = propInst.Val as byte[];

    if (null == thumbnailRaw || 0 == thumbnailRaw.Length)
        return null;

    Image retImage = null;

    using (System.IO.MemoryStream memStream = new System.IO.MemoryStream(thumbnailRaw))
    {
        using (System.IO.BinaryReader br = new System.IO.BinaryReader(memStream))
        {
            int CF_METAFILEPICT = 3;
            int CF_ENHMETAFILE = 14;

            int clipboardFormatId = br.ReadInt32(); /*int clipFormat =*/
            bool bytesRepresentMetafile = (clipboardFormatId == CF_METAFILEPICT || clipboardFormatId == CF_ENHMETAFILE);
            try
            {
                        
                if (bytesRepresentMetafile)
                {
                    // the bytes represent a clipboard metafile

                    // read past header information
                    br.ReadInt16();
                    br.ReadInt16();
                    br.ReadInt16();
                    br.ReadInt16();

                    System.Drawing.Imaging.Metafile mf = new System.Drawing.Imaging.Metafile(br.BaseStream);
                    retImage = mf.GetThumbnailImage(width, height, new Image.GetThumbnailImageAbort(getThumbnailImageAbort), IntPtr.Zero);
                }
                else 
                {
                    // the bytes do not represent a metafile, try to convert to an Image
                    memStream.Seek(0, System.IO.SeekOrigin.Begin);
                    Image im = Image.FromStream(memStream, true, false);

                    retImage = im.GetThumbnailImage(width, height, new Image.GetThumbnailImageAbort(getThumbnailImageAbort), IntPtr.Zero);
                }
            }
            catch
            {
            }
        }
    }

    return retImage;
}

private static bool getThumbnailImageAbort()
{
    return false;
}
</pre>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div class="mainpage">
    <br />
    VB.NET:<br />
</div>

<div class="mainpage">
    <table cellspacing="2" cellpadding="2" width="100%" border="1">
        <tbody>
            <tr>
                <td valign="top">
                    <pre>
Public Shared Function RenderThumbnailToImage(propInst As PropInst, width As Integer, height As Integer) As Image
        ' convert the property value to a byte array
        Dim thumbnailRaw As Byte() = TryCast(propInst.Val, Byte())

        If thumbnailRaw Is Nothing OrElse 0 = thumbnailRaw.Length Then
                Return Nothing
        End If

        Dim retImage As Image = Nothing

        Using memStream As New System.IO.MemoryStream(thumbnailRaw)
                Using br As New System.IO.BinaryReader(memStream)
                        Dim CF_METAFILEPICT As Integer = 3
                        Dim CF_ENHMETAFILE As Integer = 14

                        Dim clipboardFormatId As Integer = br.ReadInt32()
                        'int clipFormat =
                        Dim bytesRepresentMetafile As Boolean = (clipboardFormatId = CF_METAFILEPICT OrElse clipboardFormatId = CF_ENHMETAFILE)
                        Try

                                If bytesRepresentMetafile Then
                                        ' the bytes represent a clipboard metafile

                                        ' read past header information
                                        br.ReadInt16()
                                        br.ReadInt16()
                                        br.ReadInt16()
                                        br.ReadInt16()

                                        Dim mf As New System.Drawing.Imaging.Metafile(br.BaseStream)
                                        retImage = mf.GetThumbnailImage(width, height, New Image.GetThumbnailImageAbort(AddressOf getThumbnailImageAbort), IntPtr.Zero)
                                Else
                                        ' the bytes do not represent a metafile, try to convert to an Image
                                        memStream.Seek(0, System.IO.SeekOrigin.Begin)
                                        Dim im As Image = Image.FromStream(memStream, True, False)

                                        retImage = im.GetThumbnailImage(width, height, New Image.GetThumbnailImageAbort(AddressOf getThumbnailImageAbort), IntPtr.Zero)
                                End If
                        Catch
                        End Try
                End Using
        End Using

        Return retImage
End Function

Private Shared Function getThumbnailImageAbort() As Boolean
        Return False
End Function
                                
</pre>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<p class="mainpage">&nbsp;</p><!--DXMETADATA end-->
            <a name="seealsobookmark"></a>
            <!--DXMETADATA start type="FilteredItemList" scrap="CATEGORISED_LINKS" namespace="linkcategory" source="Item" filter="" NoHeader="True" NoFooter="True" format="%%replaceinquotes:value=false%%%%scrap:name=_COLLAPSIBLE_HEADER,idprefix=seealso,caption=""%%phrase:name=SeeAlso%%%%designlist:tagidentifier=seealso,itemtype=See Also%%""%%%%filtereditemlist%%</div>"--><!--DXMETADATA end-->
        </div>
        <!--DXMETADATA start type="Scrap" condition="communityenabled" name="_COMMUNITY_FOOTER" --><!--DXMETADATA end -->
        <div id="pagefooter">
            <!--DXMETADATA start type="Variable" name="CopyrightNotice" format="<p>&nbsp;</p><p>&nbsp;</p><hr style=""height: 1px"" /><p>%%variable%%</p>" --><!--DXMETADATA end -->
        </div>
        <!--DXMETADATA start type="FeedbackSection" --><!--DXMETADATA end -->
    </div>
    <!--DXMETADATA start type="Variable" name="NonScrollingPageFooter" format="<div id=nonscrollingpagefooter>%%variable%%</div>" --><div id=nonscrollingpagefooter>&copy;2025. All Rights Reserved.</div><!--DXMETADATA end -->
</body>
</html>